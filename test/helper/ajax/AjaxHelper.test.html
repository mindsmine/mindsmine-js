<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <title>Ajax Helper Test</title>

    <script type="text/javascript" src="../../../../../dist/@REQUIRE_FILE@"></script>

    <style>
        table {
            border-collapse: collapse;
        }

        th, td {
            border: 1px solid #DDDDDD;
            padding: 7px 10px;
        }

        th {
            background-color: #F0F0F0;
        }

        .currency {
            text-align: right;
        }
    </style>
</head>
<body onload="_onDOMLoad()">
<div id="mainContent">
    <table>
        <tbody id="content"></tbody>
    </table>
</div>
</body>
<script>
    const _onDOMLoad = function () {
        mindsmine.Ajax.request(
            "GET",
            "https://api.iextrading.com/1.0/stock/market/batch?types=quote&symbols=AAPL,ALBO",
            {
                beforeRequest: function () {
                    document.getElementById("content").innerHTML = "";
                }
            }
        ).then(function (response) {
            let __responseJSON = JSON.parse(response.responseText);

            let __innerHTML = [];

            for (let __stock in __responseJSON) {
                if (__responseJSON.hasOwnProperty(__stock)) {
                    let __quote = __responseJSON[__stock]["quote"];

                    __innerHTML.push(`
                        <tr>
                            <td><a target="_blank" href="http://finance.yahoo.com/quote/${__quote.symbol}">${__quote.symbol}</a></td>
                            <td>${parseFloat(__quote.latestPrice)}</td>
                            <td>${__quote.latestTime}</td>
                        </tr>
                    `);
                }
            }

            document.getElementById("content").innerHTML = __innerHTML.join("");
        }).catch(function (response) {
            document.getElementById("mainContent").innerHTML = `Everything just broke down (status code = ${response.status})`;
        });
    };
</script>
</html>